#!/usr/bin/env python3
"""
Adds a "Go Back" link to every .html file in a folder (and subfolders).
The link uses JavaScript history.back() to return to the previous page.

Usage:
    python add_goback.py /path/to/folder
"""

import os
import re
import sys

GO_BACK_HTML = '<p style="margin-bottom:1em;"><a href="javascript:history.back()" style="font-size:1em;">&larr; Go Back</a></p>'

def add_goback(filepath):
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # Skip if already has a go back link
    if 'history.back()' in content:
        print(f"  ⏭ Already has Go Back: {filepath}")
        return

    # Insert after <body...> tag
    new_content, count = re.subn(
        r'(<body[^>]*>)',
        r'\1\n' + GO_BACK_HTML,
        content,
        count=1
    )

    if count > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(new_content)
        print(f"  ✔ Added Go Back: {filepath}")
    else:
        print(f"  ✘ No <body> tag found: {filepath}")

def main():
    if len(sys.argv) < 2:
        print("Usage: python add_goback.py /path/to/folder")
        sys.exit(1)

    folder = sys.argv[1]

    if not os.path.isdir(folder):
        print(f"Error: '{folder}' is not a directory")
        sys.exit(1)

    count = 0
    for root, dirs, files in os.walk(folder):
        for fname in files:
            if fname.lower().endswith('.html'):
                add_goback(os.path.join(root, fname))
                count += 1

    print(f"\nDone — processed {count} HTML file(s)")

if __name__ == '__main__':
    main()
